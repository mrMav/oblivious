(function(){var p=function(a){this.seed=a;this.rnd=new Phaser.RandomDataGenerator(this.seed);this.vonNeighbours=p.vonNeumannNeighborhood(2,2)};p.prototype.makeMaze=function(a,b){a=void 0===a?21:a;b=void 0===b?21:b;for(var c=[],d=[],e=[],k="",g=1,f=1,h=0;h<b;h++){c[h]=[];for(var m=0;m<a;m++)c[h][m]=1}c[g][f]=0;for(d.push(f+f*a);0<d.length;)if(h=[],0<g+2&&g+2<b-1&&1==c[g+2][f]&&h.push("S"),0<g-2&&g-2<b-1&&1==c[g-2][f]&&h.push("N"),0<f-2&&f-2<a-1&&1==c[g][f-2]&&h.push("W"),0<f+2&&f+2<a-1&&1==c[g][f+
2]&&h.push("E"),0<h.length){h=h[this.rnd.between(0,h.length-1)];h!==k&&(e.push(new v),e[e.length-1].data.push([g,f]));k=h;switch(h){case "N":c[g-2][f]=0;c[g-1][f]=0;e[e.length-1].data.push([g-1,f]);e[e.length-1].data.push([g-2,f]);e[e.length-1].direction="n";g-=2;break;case "S":c[g+2][f]=0;c[g+1][f]=0;e[e.length-1].data.push([g+1,f]);e[e.length-1].data.push([g+2,f]);e[e.length-1].direction="s";g+=2;break;case "W":c[g][f-2]=0;c[g][f-1]=0;e[e.length-1].data.push([g,f-1]);e[e.length-1].data.push([g,
f-2]);e[e.length-1].direction="w";f-=2;break;case "E":c[g][f+2]=0,c[g][f+1]=0,e[e.length-1].data.push([g,f+1]),e[e.length-1].data.push([g,f+2]),e[e.length-1].direction="e",f+=2}d.push(f+g*a)}else f=d.pop(),g=Math.floor(f/a),f%=a;for(d=0;d<e.length;d++)e[d].extrapolate();return{width:a,height:b,corridors:e,grid:c}};p.prototype.makeMaze2=function(a,b){a=void 0===a?21:a;b=void 0===b?21:b;for(var c=[],d=[],e=[],k="",g=[],f=1,h=1,m=0;m<b;m++){c[m]=[];for(var n=0;n<a;n++)c[m][n]=1}c[f][h]=0;for(d.push(h+
h*a);0<d.length;)if(m=[],0<f+2&&f+2<b-1&&1===c[f+2][h]&&m.push("S"),0<f-2&&f-2<b-1&&1===c[f-2][h]&&m.push("N"),0<h-3&&h-3<a-1&&1===c[f][h-3]&&m.push("W"),0<h+3&&h+3<a-1&&1===c[f][h+3]&&m.push("E"),0<m.length){m=m[this.rnd.between(0,m.length-1)];m!==k&&(e.push(new v),e[e.length-1].data.push([f,h]));k=m;switch(m){case "N":c[f-2][h]=0;c[f-1][h]=0;1===c[f][h-1]&&(c[f][h-1]=2);c[f-1][h-1]=2;c[f-2][h-1]=2;e[e.length-1].data.push([f-1,h]);e[e.length-1].data.push([f-2,h]);e[e.length-1].direction="n";f-=2;
break;case "S":c[f+2][h]=0;c[f+1][h]=0;1===c[f][h-1]&&(c[f][h-1]=2);c[f+1][h-1]=2;c[f+2][h-1]=2;e[e.length-1].data.push([f+1,h]);e[e.length-1].data.push([f+2,h]);e[e.length-1].direction="s";f+=2;break;case "W":c[f][h-3]=0;c[f][h-2]=0;c[f][h-1]=0;c[f][h-4]=2;e[e.length-1].data.push([f,h-1]);e[e.length-1].data.push([f,h-2]);e[e.length-1].data.push([f,h-3]);e[e.length-1].direction="w";h-=3;break;case "E":c[f][h+3]=0,c[f][h+2]=0,c[f][h+1]=0,1===c[f][h-1]&&(c[f][h-1]=2),e[e.length-1].data.push([f,h+1]),
e[e.length-1].data.push([f,h+2]),e[e.length-1].data.push([f,h+3]),e[e.length-1].direction="e",h+=3}d.push(h+f*a)}else m=d.pop(),g.push([f,h+1]),f=Math.floor(m/a),h=m%a;for(d=0;d<e.length;d++)e[d].extrapolate(),e[d].shiftData(0,1);for(d=0;d<b;d++)c[d].unshift(1);return{width:a+1,height:b,corridors:e,deadEnds:g,grid:c}};p.prototype.findFurthestTile=function(a){for(var b=a.length,c=0,d=0,e=0;e<b;e++){var k=a[e][0]+a[e][1];k>c&&(c=k,d=e)}return d};p.prototype.bitmaskCeilings=function(a,b){var c=a.length-
1,d=a[0].length-1;if(0<b[0]){var e=1===a[b[0]-1][b[1]]?1:0;var k=2*e}else k=0;b[0]<c?(e=1===a[b[0]+1][b[1]]?1:0,c=4*e):c=0;if(0<b[1]){e=1===a[b[0]][b[1]-1]?1:0;var g=1*e}else g=0;b[1]<d?(e=1===a[b[0]][b[1]+1]?1:0,d=8*e):d=0;return k+c+g+d};p.prototype.getWallFrame=function(a,b){if(1===a[b[0]-1][b[1]]||1===a[b[0]+1][b[1]])return 21;if(0===a[b[0]-1][b[1]]&&0===a[b[0]+1][b[1]])return 23;if(0===a[b[0]-1][b[1]])return 20;if(0===a[b[0]+1][b[1]])return 22;if(2===a[b[0]-1][b[1]]||2===a[b[0]+1][b[1]])return 21;
console.warn("No Wall Frame found!"+b)};p.prototype.generateRoom=function(a,b,c,d,e){var l=a[0].length;if(b+d<a.length&&c+e<l)for(l=b;l<b+d;l++)for(var g=c;g<c+e;g++)a[l][g]=0;else console.warn("Room not generated at x:"+b+", y:"+c+", w:"+d+", h:"+e+"!")};p.prototype.findPath=function(a,b,c){function d(a,b){return null!=g[a]&&null!=g[a][b]&&0>=g[a][b]}function e(a,b){return{Parent:a,value:b.x+b.y*n,x:b.x,y:b.y,f:0,g:0}}for(var k=Math.abs,g=[],f=0;f<a.length;f++)g[f]=a[f].slice();if(g.length<g[0].length)for(a=
g[0].length-g.length,f=0;f<a;f++){console.log(1);for(var h=[],m=0;m<g[0].length;m++)h.push(1);g.push(h)}else if(g[0].length<g.length)for(a=g.length-g[0].length,f=0;f<g.length;f++)for(h=0;h<a;h++)g[f].push(1);var n=g[0].length,p=g.length,q=n*p,u=function(a,b){return k(a.x-b.x)+k(a.y-b.y)};return function(){for(var a=e(null,{x:b[0],y:b[1]}),f=e(null,{x:c[0],y:c[1]}),g=Array(q),a=[a],h=[],l=[],k,m,r,t,w;m=a.length;){k=q;r=-1;for(t=0;t<m;t++)a[t].f<k&&(k=a[t].f,r=t);m=a.splice(r,1)[0];if(m.value===f.value){r=
h[h.push(m)-1];do l.push([r.x,r.y]);while(r=r.Parent);g=h=a=[];l.reverse()}else{t=m.x;k=m.y;r=k-1;w=k+1;var C=t+1,v=t-1,x=-1<r&&d(t,r),y=w<p&&d(t,w),z=C<n&&d(C,k),B=-1<v&&d(v,k),A=[];x&&A.push({x:t,y:r});z&&A.push({x:C,y:k});y&&A.push({x:t,y:w});B&&A.push({x:v,y:k});k=A;t=0;for(w=k.length;t<w;t++)r=e(m,k[t]),g[r.value]||(r.g=m.g+u(k[t],m),r.f=r.g+u(k[t],f),a.push(r),g[r.value]=!0);h.push(m)}}return l}()};p.vonNeumannNeighborhood=function(a,b){a=a||1;b=b||2;for(var c=2*a+1,d=Math.pow(c,b),e=(d-1)/
2,k=[[0,0]],g=0;g<d;g++)if(g!==e){for(var f=Array(b),h=0,m=g,n=0;n<b;n++){var p=m%Math.pow(c,n+1),q=p/Math.pow(c,n)-a;f[n]=q;h+=Math.abs(q);m-=p}h<=a&&k.push(f)}return k};var G=function(a,b,c,d,e,k,g){k=void 0===k?100:k;this.game=a;this.basePoint=new Phaser.Point(b,c);this.pointer=null;this.maxRadius=k;this.properties={inUse:!1,x:0,y:0,deltaX:0,deltaY:0,distance:0,angle:0};this.fixedPad=this.game.add.image(this.basePoint.x,this.basePoint.y,"gamepad","fixedPad");this.movePad=this.game.add.image(this.basePoint.x,
this.basePoint.y,"gamepad","movingPad");this.fixedPad.anchor.set(.5);this.fixedPad.alpha=.4;this.fixedPad.fixedToCamera=!0;this.movePad.anchor.set(.5);this.movePad.alpha=.4;this.movePad.fixedToCamera=!0;this.buttonBasePoint=new Phaser.Point(d,e);this.button=this.game.add.image(this.buttonBasePoint.x,this.buttonBasePoint.y,"gamepad","button");this.button.inUse=!1;this.button.fixedToCamera=!0;this.button.alpha=.4;this.button.anchor.set(.5)};G.prototype={destroy:function(){this.fixedPad.kill();this.movePad.kill();
this.button.kill()},update:function(){var a=this,b=!0;this.button.isDown=!1;this.button.alpha=.4;this.game.input.pointers.forEach(function(c){b=a.testDistance(c)});(b=this.testDistance(this.game.input.mousePointer))&&(null===this.pointer||this.pointer.isUp)&&(this.displace(this.basePoint,this),this.properties.inUse=!1,this.pointer=null,this.fixedPad.alpha=.4,this.movePad.alpha=.4)},testDistance:function(a){var b=!0,c=this.basePoint.distance(a.position);a.isDown&&(a===this.pointer||c<this.maxRadius)&&
(b=!1,this.inUse=!0,this.pointer=a,this.displace(a.position));c=this.buttonBasePoint.distance(a.position);a.isDown&&c<this.button.width&&(this.button.isDown=!0,this.button.alpha=.8);return b},displace:function(a){var b=a.x-this.basePoint.x,c=a.y-this.basePoint.y,d=this.basePoint.angle(a);this.basePoint.distance(a)>this.maxRadius&&(b=0===b?0:Math.cos(d)*this.maxRadius,c=0===c?0:Math.sin(d)*this.maxRadius);this.properties.x=parseInt(b/this.maxRadius*100,10);this.properties.y=parseInt(c/this.maxRadius*
100,10);this.properties.deltaX=b/this.maxRadius;this.properties.deltaY=c/this.maxRadius;this.movePad.cameraOffset.x=this.basePoint.x+b;this.movePad.cameraOffset.y=this.basePoint.y+c;this.fixedPad.alpha=.8;this.movePad.alpha=.8}};var q=function(a,b,c,l,e,k){var g=this;Phaser.Sprite.call(this,a,b,c,"tileset",59);this.anchor.set(.5);this.smoothed=!1;this.scaleValue=.75*d.tilesSize/16;this.scale.set(this.scaleValue);this.speed=this.initialSpeed=100*this.scale.x;this.facing=2;this.health=this.maxHealth=
5;this.deadLocation=new Phaser.Point;this.attackRate=400;this.attackReach=d.tilesSize/2;this.attackduration=100;this.lastAttack=0;this.attacking=!1;this.damage=1;this.hostiles=[];this.killedEnemies=0;this.imuneInterval=1E3;this.imuneTimer=0;this.imune=!1;this.pickups=0;a.physics.enable(this);this.body.allowGravity=!1;this.neighboursDimension=2;this.tileBasedPosition=[0,0];this.neighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2);this.worldNeighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,
2);this.attackTween=a.add.tween(this.position).to({x:0,y:0},this.attackduration,Phaser.Easing.Linear.Out);this.attackTween.onComplete.add(function(){g.game.physics.arcade.overlap(g,g.hostiles,function(a,b){g.killedEnemies+=g.makeDamage(b);g.playHitSound()})});this.recoverAttackTween=a.add.tween(this.position).to({x:0,y:0},this.attackduration,Phaser.Easing.Linear.Out);this.recoverAttackTween.onComplete.add(function(){g.attacking=!1});this.attackTween.chain(this.recoverAttackTween);this.sfx=k};q.prototype=
Object.create(Phaser.Sprite.prototype);q.prototype.constructor=Phaser.Sprite;q.prototype.update=function(){this.imune&&(this.tint=16711680,this.alpha=10<this.game.time.now%20?.5:1,this.game.time.now>this.imuneTimer&&(this.imune=!1,this.alpha=1,this.tint=16777215));this.body.velocity.multiply(.8,.8)};q.prototype.attack=function(a){if(this.lastAttack<this.game.time.now){this.attacking=!0;a=this.attackReach;var b=0,c=0;switch(this.facing){case 0:b=-a;break;case 1:c=-a;break;case 2:b=a;break;case 3:c=
a}this.recoverAttackTween.timeline[0].vEnd.x=this.position.x;this.recoverAttackTween.timeline[0].vEnd.y=this.position.y;this.attackTween.timeline[0].vEnd.x=this.position.x+b;this.attackTween.timeline[0].vEnd.y=this.position.y+c;this.attackTween.start();this.playAttackSound();this.lastAttack=this.game.time.now+this.attackRate}};q.prototype.moveRight=function(a){a=void 0===a?this.speed:a;this.body.velocity.x=a;this.facing=2;this.playFootstepSound();this.scale.x=this.scaleValue};q.prototype.moveLeft=
function(a){a=void 0===a?-this.speed:a;this.body.velocity.x=a;this.facing=0;this.playFootstepSound();this.scale.x=-this.scaleValue};q.prototype.moveDown=function(a){a=void 0===a?this.speed:a;this.body.velocity.y=a;this.facing=3;this.playFootstepSound()};q.prototype.moveUp=function(a){a=void 0===a?-this.speed:a;this.body.velocity.y=a;this.facing=1;this.playFootstepSound()};q.prototype.die=function(){this.game.state.start("Game.Play")};q.prototype.updateNeighbourTiles=function(a){for(var b=this.neighbourTiles.length,
c=a.length,d=a[0].length,e=0;e<b;e++){var k=this.tileBasedPosition[0]+this.neighbourTiles[e][0],g=this.tileBasedPosition[1]+this.neighbourTiles[e][1];0<=k&&k<c&&"undefined"!==a[k]?(this.worldNeighbourTiles[e][0]=k,this.worldNeighbourTiles[e][1]=0<=g&&g<d&&"undefined"!==a[k][g]?g:-1):this.worldNeighbourTiles[e][0]=-1}};q.prototype.generateNewNeighbours=function(a){this.neighboursDimension=1<=this.neighboursDimension+a?this.neighboursDimension+a:1;this.neighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,
2);this.worldNeighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2)};q.prototype.receiveDamage=function(a){this.health-=a;0>=this.health?(this.deadLocation.x=this.position.x,this.deadLocation.y=this.position.y,this.kill()):(this.imune=!0,this.imuneTimer=this.game.time.now+this.imuneInterval);this.playHurtSound()};q.prototype.makeDamage=function(a){return a.receiveDamage(this.damage)};q.prototype.playFootstepSound=function(){5>this.game.time.now%80&&this.sfx.play("footstep"+this.game.rnd.between(1,
3))};q.prototype.playHitSound=function(){this.sfx.play("hit"+this.game.rnd.between(1,5))};q.prototype.playAttackSound=function(){this.sfx.play("attack"+this.game.rnd.between(1,3))};q.prototype.playHurtSound=function(){this.sfx.play("playerHurt"+this.game.rnd.between(1,2))};var u=function(a,b,c,l,e,k,g){Phaser.Sprite.call(this,a,b,c,l,e);this.inputEnabled=!0;this.anchor.set(.5);this.smoothed=!1;this.scale.set(.75*d.tilesSize/16);a.physics.enable(this);this.body.allowGravity=!1;this.tileBasedPosition=
[0,0];this.turnAroundPoint=[0,0];this.facing=0;this.corridor=k;this.initialSpeed=d.tilesSize/16*20;"w"===k.direction?this.speed=new Phaser.Point(0,this.initialSpeed):"e"===k.direction?this.speed=new Phaser.Point(0,-this.initialSpeed):"n"===k.direction?this.speed=new Phaser.Point(this.initialSpeed,0):"s"===k.direction&&(this.speed=new Phaser.Point(-this.initialSpeed,0));this.seekTurnAround=!0;this.corridorEnd=0;this.health=this.maxHealth=2;this.damage=1;this.blinking=!1;this.blinkingTimer=0;this.blinkingInterval=
500;this.sfx=g;this.noiseTimer=0;this.noiseInterval=2E3};u.prototype=Object.create(Phaser.Sprite.prototype);u.prototype.constructor=Phaser.Sprite;u.prototype.update=function(){this.game.time.now>this.noiseTimer&&(10>=this.game.rnd.between(1,100)&&this.playMonsterNoiseSound(),this.noiseTimer=this.game.time.now+this.noiseInterval);this.seekTurnAround&&this.tileBasedPosition[0]===this.turnAroundPoint[0]&&this.tileBasedPosition[1]===this.turnAroundPoint[1]&&(this.flipDirection(),this.seekTurnAround=!1);
if(this.tileBasedPosition[0]!==this.turnAroundPoint[0]||this.tileBasedPosition[1]!==this.turnAroundPoint[1])this.seekTurnAround=!0;this.blinking&&(this.tint=16711680,this.alpha=10<this.game.time.now%20?.5:1,this.game.time.now>this.blinkingTimer&&(this.blinking=!1,this.alpha=1,this.tint=16777215,this.setSpeed(this.initialSpeed)));this.body.velocity.x=this.speed.x;this.body.velocity.y=this.speed.y};u.prototype.flipDirection=function(){0!==this.speed.x&&(this.speed.x*=-1);0!==this.speed.y&&(this.speed.y*=
-1);0===this.corridorEnd?(this.turnAroundPoint[0]=this.corridor.data[this.corridor.data.length-1][0],this.turnAroundPoint[1]=this.corridor.data[this.corridor.data.length-1][1],this.facing=this.corridorEnd=1):1===this.corridorEnd&&(this.turnAroundPoint[0]=this.corridor.data[0][0],this.turnAroundPoint[1]=this.corridor.data[0][1],this.corridorEnd=0,this.facing=-1)};u.prototype.setSpeed=function(a){0!==this.speed.x?this.speed.x=0<this.speed.x?a:-a:0!==this.speed.y&&(this.speed.y=0<this.speed.y?a:-a)};
u.prototype.receiveDamage=function(a,b){this.health-=a;if(0>=this.health)return this.destroy(),this.sfx.play("monsterDie"),1;this.blinkingTimer=this.game.time.now+this.blinkingInterval;this.blinking=!0;this.sfx.play("monsterHit");return 0};u.prototype.playMonsterNoiseSound=function(){this.sfx.play("monsterNoise"+this.game.rnd.between(1,2))};var x=function(a,b,c){Phaser.Image.call(this,a,b,c,"tileset");this.animations.add("base",[52,53],4,!0);this.animations.play("base");this.smoothed=!1;this.neighboursDimension=
2;this.tileBasedPosition=[0,0];this.neighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2);this.worldNeighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2)};x.prototype=Object.create(Phaser.Sprite.prototype);x.prototype.constructor=Phaser.Sprite;x.prototype.updateNeighbourTiles=function(a){for(var b=this.neighbourTiles.length,c=a.length,d=a[0].length,e=0;e<b;e++){var k=this.tileBasedPosition[0]+this.neighbourTiles[e][0],g=this.tileBasedPosition[1]+this.neighbourTiles[e][1];
0<=k&&k<c&&"undefined"!==a[k]?(this.worldNeighbourTiles[e][0]=k,this.worldNeighbourTiles[e][1]=0<=g&&g<d&&"undefined"!==a[k][g]?g:-1):this.worldNeighbourTiles[e][0]=-1}};var B=function(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.smoothed=!1;this.tileBasedPosition=[0,0]};B.prototype=Object.create(Phaser.Sprite.prototype);B.prototype.constructor=Phaser.Sprite;var D=function(a,b,c,d,e){Phaser.Image.call(this,a,b,c,d,e);this.anchor.set(.5);this.smoothed=!1;this.tileBasedPosition=[0,0]};D.prototype=
Object.create(Phaser.Image.prototype);D.prototype.constructor=Phaser.Image;var E=function(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.smoothed=!1;this.alpha=this.maxAlpha=1;this.tileBasedPosition=[0,0]};E.prototype=Object.create(Phaser.Sprite.prototype);E.prototype.constructor=Phaser.Sprite;var v=function(){this.data=[];this.direction=""};v.prototype.extrapolate=function(){var a=this.data[0][0]-this.data[1][0],b=this.data[0][1]-this.data[1][1];this.data[0][0]!==this.data[1][0]?(this.data.unshift([this.data[0][0]+
a,this.data[0][1]]),this.data.push([this.data[this.data.length-1][0]+-1*a,this.data[this.data.length-1][1]])):this.data[0][1]!==this.data[1][1]&&(this.data.unshift([this.data[0][0],this.data[0][1]+b]),this.data.push([this.data[this.data.length-1][0],this.data[this.data.length-1][1]+-1*b]))};v.prototype.shiftData=function(a,b){a=void 0===a?0:a;b=void 0===b?0:b;for(var c=0;c<this.data.length;c++)this.data[c][0]+=a,this.data[c][1]+=b};var F=function(a,b,c,d,e){Phaser.Sprite.call(this,a,b,c,d,e);this.smoothed=
!1;a.physics.enable(this);this.body.immovable=!0;this.tileBasedPosition=[0,0]};F.prototype=Object.create(Phaser.Sprite.prototype);F.prototype.constructor=Phaser.Sprite;var y=function(a,b,c,d,e){Phaser.Image.call(this,a,b,c,d,e);this.smoothed=!1;this.tileBasedPosition=[0,0]};y.prototype=Object.create(Phaser.Image.prototype);y.prototype.constructor=Phaser.Image;var z=function(a,b,c){Phaser.Image.call(this,a,b,c,"tileset");this.animations.add("base",[48,49],4,!0);this.animations.play("base");this.anchor.set(.5);
this.smoothed=!1;this.scaleValue=.75*d.tilesSize/16;this.neighboursDimension=1;this.tileBasedPosition=[0,0];this.neighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2);this.worldNeighbourTiles=p.vonNeumannNeighborhood(this.neighboursDimension,2)};z.prototype=Object.create(Phaser.Sprite.prototype);z.prototype.constructor=Phaser.Sprite;z.prototype.updateNeighbourTiles=function(a){for(var b=this.neighbourTiles.length,c=a.length,d=a[0].length,e=0;e<b;e++){var k=this.tileBasedPosition[0]+
this.neighbourTiles[e][0],g=this.tileBasedPosition[1]+this.neighbourTiles[e][1];0<=k&&k<c&&"undefined"!==a[k]?(this.worldNeighbourTiles[e][0]=k,this.worldNeighbourTiles[e][1]=0<=g&&g<d&&"undefined"!==a[k][g]?g:-1):this.worldNeighbourTiles[e][0]=-1}};var d={author:"mrmav",name:"OBLIVIOUS",config:{width:640,height:360,renderer:Phaser.AUTO,enableDebug:!1},tilesSize:48,hash:"",level:1,mapWidth:6,mapHeight:5,playerHealth:0,deaths:0,lighting:!0,bodys:!1,DEBUG_MODE:!1,makeid:function(){for(var a="",b=0;5>
b;b++)a+="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.floor(36*Math.random()));return a},setGameData:function(){localStorage["oblivious.hash"]=d.hash;localStorage["oblivious.level"]=d.level;localStorage["oblivious.playerHealth"]=d.playerHealth;localStorage["oblivious.mapWidth"]=d.mapWidth;localStorage["oblivious.mapHeight"]=d.mapHeight;localStorage["oblivious.deaths"]=d.deaths},getGameData:function(){0<localStorage.length&&(d.hash=localStorage["oblivious.hash"],d.level=parseInt(localStorage["oblivious.level"]),
d.playerHealth=parseInt(localStorage["oblivious.playerHealth"]),d.mapWidth=parseInt(localStorage["oblivious.mapWidth"]),d.mapHeight=parseInt(localStorage["oblivious.mapHeight"]),d.deaths=parseInt(localStorage["oblivious.deaths"]))},reset:function(){localStorage.clear();d.hash=d.makeid();d.level=1;d.mapWidth=6;d.mapHeight=5;d.playerHealth=0;d.deaths=0},goFull:function(){n.scale.isFullScreen?n.scale.stopFullScreen():n.scale.startFullScreen(!1)},Credits:function(){}};d.Credits.prototype={init:function(){},
create:function(){var a=this;this.titleText=this.add.bitmapText(this.game.width/2,50,"font","Made possible by:",32);this.titleText.anchor.set(.5,0);this.creditsText=this.add.bitmapText(this.game.width/2,100,"font","www.kenney.nl:\nFont, Tileset, Characters, Mobile controls & Sound Effects\n\nwww.opengameart.org:\nMatt Hackett of Lost Decade Games: Life heart icon\nIndependent.nu: Music Theme & Sound effects\nremaxim: Melee Sound Effects\nJute: Sound Effects\n\nGame Developer:\nmrmav",10);this.creditsText.anchor.set(.5,0);this.creditsText.align=
"center";this.menuText=this.add.bitmapText(2,this.game.height-2,"font","Menu",10);this.menuText.anchor.set(0,1);this.menuText.inputEnabled=!0;this.menuText.events.onInputDown.add(function(){a.game.state.start("Game.Menu")})}};d.HowTo=function(){};d.HowTo.prototype={init:function(){},create:function(){var a=this;this.howToText=this.add.bitmapText(this.game.width/2,100,"font","On desktop:\nUse the arrows to control the hero.\nPress the 'Z' key to perform an attack!\n\nOn mobile:\nUse the analog at the left to control the hero.\nPress the 'A' button on the right to perform an attack!\n\nThe hero will attack to the direction you were last moving!\n",
10);this.howToText.anchor.set(.5,0);this.howToText.align="center";this.menuText=this.add.bitmapText(2,this.game.height-2,"font","Menu",10);this.menuText.anchor.set(0,1);this.menuText.inputEnabled=!0;this.menuText.events.onInputDown.add(function(){a.game.state.start("Game.Menu")})}};d.Boot=function(){};d.Boot.prototype={init:function(){this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.scale.pageAlignHorizontally=!0;this.game.renderer.renderSession.roundPixels=!0;Phaser.Canvas.setImageRenderingCrisp(this.game.canvas);
this.stage.setBackgroundColor("#000000");this.time.advancedTiming=!0;d.hash=d.makeid()},preload:function(){this.load.bitmapFont("font","assets/fonts/kenpixel_regular.png","assets/fonts/kenpixel_regular.fnt")},create:function(){this.state.start("Game.Preload")}};d.Preload=function(){};d.Preload.prototype={init:function(){this.text=this.add.bitmapText(this.world.centerX,this.world.centerY,"font","Loading: 0%",16);this.text.anchor.set(.5)},preload:function(){this.load.spritesheet("tileset","assets/tileset.png",
16,16,-1,0,1);this.load.atlas("gamepad","assets/gamepad.png","assets/gamepad.json",Phaser.Loader.TEXTURE_ATLAS_JSON_HASH);this.load.audio("sfx","assets/sound/optimized/sfx.ogg");this.load.audio("ambient","assets/sound/optimized/atmoseerie01.ogg");this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.text.text="Loading: "+a+"%"},loadUpdate:function(){},create:function(){this.add.tween(this.text.scale).to({x:0,y:0},1E3,"Elastic.easeIn",!0,250);this.time.events.add(1200,function(){this.state.start("Game.Menu")},
this)}};d.Menu=function(){};d.Menu.prototype={init:function(){},create:function(){var a=this;this.ambient=this.add.audio("ambient");this.ambient.play("",0,1,!0);this.titleText=this.add.bitmapText(this.game.width/2,50,"font",d.name,64);this.titleText.anchor.set(.5,0);this.add.tween(this.titleText.scale).to({x:1.1,y:1.1},1E3,Phaser.Easing.Bounce.None,!0,0,-1,!0).start();this.playText=this.add.bitmapText(2,this.game.height-100,"font","",16);this.playText.anchor.set(0,1);this.playText.inputEnabled=!0;
this.playText.events.onInputDown.add(function(){a.game.state.start("Game.Play")});this.goFullScreen=this.add.bitmapText(this.game.width-2,2,"font","fullscreen",10);this.goFullScreen.anchor.set(1,0);this.goFullScreen.inputEnabled=!0;this.goFullScreen.events.onInputDown.add(function(){d.goFull()});if(1>localStorage.length)localStorage.clear(),d.reset(),this.playText.setText("Play Game");else{d.getGameData();this.playText.setText('Continue world "'+d.hash+'", level '+d.level);this.resetText=this.add.bitmapText(2,
this.game.height-100+18,"font","reset",12);this.resetText.anchor.set(0,1);this.resetText.inputEnabled=!0;this.resetText.events.onInputDown.add(function(){d.reset();a.game.state.start("Game.Menu")});var b=1<d.deaths?"s":"";this.obliviatedText=this.add.bitmapText(this.game.width/2,150,"font","",10);this.obliviatedText.setText(d.deaths+"time"+b+" obliviated");this.obliviatedText.anchor.set(.5,0)}this.howToText=this.add.bitmapText(2,this.game.height-16,"font","How to play",10);this.howToText.anchor.set(0,
1);this.howToText.inputEnabled=!0;this.howToText.events.onInputDown.add(function(){a.game.state.start("Game.HowTo")});this.creditsText=this.add.bitmapText(2,this.game.height-2,"font","Credits",10);this.creditsText.anchor.set(0,1);this.creditsText.inputEnabled=!0;this.creditsText.events.onInputDown.add(function(){a.game.state.start("Game.Credits")});this.spaceKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);this.spaceKey.onDown.add(function(){a.game.state.start("Game.Play")})},
shutdown:function(){this.game.sound.stopAll()}};d.Play=function(){this.generator=null;this.sizeIncrementsWidth=3;this.sizeIncrementsHeight=2};d.Play.prototype={init:function(){this.killedEnemies=0;this.generator=new p([d.hash+d.level]);this.mapSize={width:d.mapWidth,height:d.mapHeight}},create:function(){var a=this;d.DEBUG_MODE&&this.game.add.plugin(Phaser.Plugin.Debug);this.physics.startSystem(Phaser.Physics.ARCADE);this.maze=this.generator.makeMaze2(this.mapSize.width,this.mapSize.height);this.world.setBounds(0,
0,this.maze.height*d.tilesSize,this.maze.width*d.tilesSize);this.ambient=this.add.audio("ambient");this.ambient.play("",0,1,!0);this.sfx=this.add.audio("sfx");this.sfx.allowMultiple=!0;this.sfx.addMarker("footstep1",0,.24);this.sfx.addMarker("footstep2",.25,.28);this.sfx.addMarker("footstep3",.55,.24);this.sfx.addMarker("attack1",.8,.4);this.sfx.addMarker("attack2",1.45,.4);this.sfx.addMarker("attack3",2.1,.4);this.sfx.addMarker("hit1",2.7,.7);this.sfx.addMarker("hit2",3.8,.7);this.sfx.addMarker("hit3",
5,.7);this.sfx.addMarker("hit4",5.9,.7);this.sfx.addMarker("hit5",6.9,.7);this.sfx.addMarker("monsterDie",8,1);this.sfx.addMarker("monsterHit",9.05,.25);this.sfx.addMarker("monsterNoise1",9.4,2.3);this.sfx.addMarker("monsterNoise2",11.8,2.3);this.sfx.addMarker("pickupCoin",14.25,.3);this.sfx.addMarker("playerHurt1",14.6,.7);this.sfx.addMarker("playerHurt2",15.36,.3);this.lightEmittingObjects=[];this.worldLightMatrix=[];this.resetWorldLightMatrix();this.tiles=this.add.group();this.wallAssets=this.add.group();
var b=this.maze.deadEnds[0];this.end=this.createEndAsset(b[0]*d.tilesSize,b[1]*d.tilesSize);this.coins=this.add.group();this.createCoins();this.enemies=this.add.group();this.numberOfEnemies=0;2<d.level&&this.createEnemies();this.player=new q(n,1.5*d.tilesSize,2.5*d.tilesSize,null,null,this.sfx);this.player.health=0<d.playerHealth?d.playerHealth:this.player.health;this.add.existing(this.player);this.player.hostiles.push(this.enemies);this.lightEmittingObjects.push(this.player);this.shades=this.add.group();
for(b=0;b<this.maze.grid[0].length;b++)for(var c=0;c<this.maze.grid.length;c++)2===this.maze.grid[c][b]?(this.tiles.add(this.createWallTile(c*d.tilesSize,b*d.tilesSize,"wall")),this.createWallAsset(c*d.tilesSize,b*d.tilesSize)):1===this.maze.grid[c][b]?this.tiles.add(this.createWallTile(c*d.tilesSize,b*d.tilesSize,"ceiling")):0===this.maze.grid[c][b]&&this.tiles.add(this.createGroundTile(c*d.tilesSize,b*d.tilesSize)),this.shades.add(this.createShadeTile(c*d.tilesSize,b*d.tilesSize,"tileset",47));
this.cameraLerp=.2;this.camera.follow(this.player,Phaser.Camera.FOLLOW_LOCKON,this.cameraLerp,this.cameraLerp);this.camera.roundPX=!1;this.camera.bounds=null;this.camera.tileBounds={topLeftCorner:[0,0],bottomRightCorner:[0,0]};this.camera.position.x=this.player.position.x;this.camera.position.y=this.player.position.y;this.game.device.desktop?(this.attackKey=this.game.input.keyboard.addKey(Phaser.Keyboard.Z),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.Z]),this.cursors=this.input.keyboard.createCursorKeys()):
this.gamepad=new G(this.game,91,this.game.height-91,this.game.width-91,this.game.height-91,81,50);this.ui=this.add.group();this.ui.fixedToCamera=!0;this.playerIcon=this.game.add.image(2,2,"tileset",59);this.hearts=this.add.group();for(b=0;b<this.player.health;b++)c=this.add.image(20+18*b,2,"tileset",50),c.scale.set(16/11),this.hearts.add(c);this.enemyIcon=this.game.add.image(2,18,"tileset",57);this.enemyCountText=this.game.add.bitmapText(20,18,"font"," 0 / "+this.numberOfEnemies,16);this.enemyIcon.addChild(this.enemyCountText);
this.coinIcon=this.game.add.image(2,36,"tileset",44);this.coinCountText=this.game.add.bitmapText(20,36,"font"," 0 / "+this.coins.children.length,16);this.coinIcon.addChild(this.coinCountText);this.ui.add(this.playerIcon);this.ui.add(this.hearts);this.ui.add(this.enemyIcon);this.ui.add(this.coinIcon);this.ui.add(this.enemyCountText);this.ui.add(this.coinCountText);this.notificationText=this.add.bitmapText(0,0,"font","",16);this.notificationText.anchor.set(.5);this.notificationText.alpha=0;this.notificationText.kill();
this.notificationTextTweenIn=this.add.tween(this.notificationText).to({alpha:1},1500,Phaser.Easing.Linear.Out);this.notificationTextTweenOut=this.add.tween(this.notificationText).to({alpha:0},2500,Phaser.Easing.Linear.In);this.notificationTextTweenIn.chain(this.notificationTextTweenOut);this.notificationTextTweenOut.onComplete.add(function(){a.notificationText.kill()});d.setGameData()},update:function(){var a=this;this.updateEnemies();this.player.alive?(this.updatePlayer(),this.physics.arcade.collide(this.tiles,
this.player),this.player.attacking||this.player.imune||this.physics.arcade.overlap(this.player,this.enemies,function(b,c){b.receiveDamage(c.damage);void 0!==a.hearts.children[a.hearts.children.length-1]&&a.hearts.children[a.hearts.children.length-1].destroy();0>=b.health&&(a.notify(a.player.position.x,a.player.position.y,"You died."),a.game.device.desktop||a.gamepad.destroy(),a.ui.killAll(),d.deaths++,d.setGameData(),a.time.events.add(5E3,function(){a.game.state.start("Game.Menu")}))}),this.updateCoinsPickup(),
this.updateUIEnemyText()):(this.camera.reset(),this.camera.focusOnXY(this.player.deadLocation.x,this.player.deadLocation.y));this.updateCameraTileBounds();this.updateTiles();this.resetWorldLightMatrix();this.updateLightEmittingObjectsNeighbours();this.updateWorldLightMatrix();this.testLevelComplete()},createCoins:function(){for(var a=this.maze.corridors.length,b=1;b<a;b++)if(50>=this.generator.rnd.between(1,100))for(var c=this.maze.corridors[b].data.length-1,l=1;l<c;l++){var e=75>=this.generator.rnd.between(0,
100),k=this.maze.corridors[b].data[l][1];this.maze.corridors[b].data[l][0]===this.end.tileBasedPosition[0]&&k===this.end.tileBasedPosition[1]&&(e=!1);e&&(e=new D(n,this.maze.corridors[b].data[l][0]*d.tilesSize+d.tilesSize/2,this.maze.corridors[b].data[l][1]*d.tilesSize+d.tilesSize/2,"tileset",44),e.scale.set(d.tilesSize/2/16),this.getTileBasedPosition(e),this.add.existing(e),this.coins.add(e))}},createShadeTile:function(a,b,c,l){a=new E(n,a,b,c,l);a.scale.set(d.tilesSize/16);this.getTileBasedPosition(a);
this.add.existing(a);return a},createEndAsset:function(a,b){var c=this.generator.rnd.between(45,46),c=new y(n,a,b,"tileset",c);this.getTileBasedPosition(c);c.scale.set(d.tilesSize/16);this.add.existing(c);return c},createWallAsset:function(a,b){var c=this.generator.rnd.between(24,43),l=this.generator.rnd.between(1,100);5>=l?(c=new x(n,a,b),c.scale.set(d.tilesSize/16),this.getTileBasedPosition(c),this.add.existing(c),this.wallAssets.add(c),this.lightEmittingObjects.push(c)):15>=l?(c=new z(n,a+d.tilesSize/
2,b+d.tilesSize/2),c.scale.set(d.tilesSize/16),this.getTileBasedPosition(c),this.add.existing(c),this.wallAssets.add(c),this.lightEmittingObjects.push(c)):50>=l&&(c=new y(n,a,b,"tileset",c),c.scale.set(d.tilesSize/16),this.add.existing(c),this.wallAssets.add(c))},createWallTile:function(a,b,c){if("ceiling"===c)c=this.generator.bitmaskCeilings(this.maze.grid,[Math.floor(a/d.tilesSize),Math.floor(b/d.tilesSize)]);else if("wall"===c)c=this.generator.getWallFrame(this.maze.grid,[Math.floor(a/d.tilesSize),
Math.floor(b/d.tilesSize)]);else{console.warn("No type specified at wall creation.");return}a=new F(n,a,b,"tileset",c);a.scale.set(d.tilesSize/16);this.getTileBasedPosition(a);this.add.existing(a);return a},createGroundTile:function(a,b){var c=new B(n,a,b,"tileset",this.generator.rnd.between(16,19));c.scale.set(d.tilesSize/16);this.getTileBasedPosition(c);this.add.existing(c);return c},createEnemies:function(){for(var a=this.maze.corridors.length,b=1;b<a;b++)if(1>this.generator.rnd.between(0,1)){var c=
new u(n,this.maze.corridors[b].data[1][0]*d.tilesSize+d.tilesSize/2,this.maze.corridors[b].data[1][1]*d.tilesSize+d.tilesSize/2,"tileset",this.generator.rnd.between(56,58),this.maze.corridors[b],this.sfx);c.turnAroundPoint[0]=this.maze.corridors[b].data[0][0];c.turnAroundPoint[1]=this.maze.corridors[b].data[0][1];this.game.add.existing(c);this.enemies.add(c);this.numberOfEnemies++}},getTileBasedPosition:function(a,b,c){a.tileBasedPosition[0]=Math.floor((a.position.x+(void 0===b?0:b))/d.tilesSize);
a.tileBasedPosition[1]=Math.floor((a.position.y+(void 0===c?0:c))/d.tilesSize)},getTileAt:function(a,b,c){a=this[a].getAt(b[1]*this.maze.height+b[0]);void 0!==c&&c(a);return a},updatePlayer:function(){this.getTileBasedPosition(this.player);if(this.game.device.desktop)this.cursors.left.isDown?this.player.moveLeft():this.cursors.right.isDown&&this.player.moveRight(),this.cursors.up.isDown?this.player.moveUp():this.cursors.down.isDown&&this.player.moveDown(),this.attackKey.isDown&&this.player.attack(this.enemies);
else{this.gamepad.update();var a=this.player.speed*this.gamepad.properties.deltaX,b=this.player.speed*this.gamepad.properties.deltaY;Math.abs(a)>=Math.abs(b)&&(0<this.gamepad.properties.x?this.player.moveRight(a):0>this.gamepad.properties.x&&this.player.moveLeft(a));Math.abs(b)>Math.abs(a)&&(0<this.gamepad.properties.y?this.player.moveDown(b):0>this.gamepad.properties.y&&this.player.moveUp(b));Math.abs(a)>Math.abs(b)?0>a?this.player.facing=0:0<a&&(this.player.facing=2):0>b?this.player.facing=1:0<
b&&(this.player.facing=3);this.gamepad.button.isDown&&this.player.attack(this.enemies)}d.bodys&&this.game.debug.body(this.player)},updateCoinsPickup:function(){var a=this;this.coins.forEach(function(b){b.alive&&b.tileBasedPosition[0]===a.player.tileBasedPosition[0]&&b.tileBasedPosition[1]===a.player.tileBasedPosition[1]&&(a.player.pickups+=1,a.sfx.play("pickupCoin"),b.kill(),a.updateUICoinText())})},updateLightEmittingObjectsNeighbours:function(){for(var a=this.lightEmittingObjects.length,b=0;b<a;b++)this.lightEmittingObjects[b].updateNeighbourTiles(this.maze.grid)},
resetWorldLightMatrix:function(){for(var a=0;a<this.maze.height;a++){this.worldLightMatrix[a]=[];for(var b=0;b<this.maze.width;b++)this.worldLightMatrix[a][b]=-10}},updateWorldLightMatrix:function(){for(var a=this.lightEmittingObjects.length,b=0;b<a;b++)if(0!==b||this.player.alive)for(var c=this.lightEmittingObjects[b],d=c.worldNeighbourTiles.length,e=0;e<d;e++){var k=c.worldNeighbourTiles[e][0],g=c.worldNeighbourTiles[e][1],f=Math.abs(c.neighbourTiles[e][0])+Math.abs(c.neighbourTiles[e][1]);-1<k&&
-1<g&&f<Math.abs(this.worldLightMatrix[k][g])&&(this.worldLightMatrix[k][g]=f)}},updateEnemies:function(){var a=this,b=0,c=0;this.enemies.forEach(function(l){c=b=0;0!==l.speed.x&&0<l.speed.x&&(b=l.width/2);0!==l.speed.x&&0>l.speed.x&&(b=-(l.width/2));0!==l.speed.y&&0<l.speed.y&&(c=l.height/2);0!==l.speed.y&&0>l.speed.y&&(c=-(l.height/2));a.getTileBasedPosition(l,b,c);if(0>l.position.x-l.width||l.position.x+l.width>a.game.world.width||0>l.position.y-l.height||l.position.y+l.height>a.game.world.height)a.enemies.remove(l,
!0,!0),a.numberOfEnemies--,console.log("Enemy out of bounds kill");d.bodys&&a.game.debug.body(l)})},updateShadeAlpha:function(a){var b=1.01*a.alpha;a.alpha=1<b?1:b;var b=a.tileBasedPosition[0],c=a.tileBasedPosition[1];-1<this.worldLightMatrix[b][c]&&(c=Phaser.Math.mapLinear(this.worldLightMatrix[b][c],0,3,.25,.75),b=.95*a.alpha,a.alpha=b>c?b:c)},updateCameraTileBounds:function(){var a=Math.floor(this.camera.view.x/d.tilesSize),b=Math.floor(this.camera.view.y/d.tilesSize),c=Math.floor((this.camera.view.x+
this.camera.view.width)/d.tilesSize),l=Math.floor((this.camera.view.y+this.camera.view.height)/d.tilesSize);this.camera.tileBounds.topLeftCorner[0]=0<a?a:0;this.camera.tileBounds.topLeftCorner[1]=0<b?b:0;this.camera.tileBounds.bottomRightCorner[0]=c>this.maze.height-1?this.maze.height-1:c;this.camera.tileBounds.bottomRightCorner[1]=l>this.maze.width-1?this.maze.width-1:l},setRenderableTiles:function(a,b){a.exists=!1;null!==a.body&&(a.body.enabled=!1);b.exists=!1;a.tileBasedPosition[0]>=this.camera.tileBounds.topLeftCorner[0]&&
a.tileBasedPosition[0]<=this.camera.tileBounds.bottomRightCorner[0]&&a.tileBasedPosition[1]>=this.camera.tileBounds.topLeftCorner[1]&&a.tileBasedPosition[1]<=this.camera.tileBounds.bottomRightCorner[1]&&(a.exists=!0,null!==a.body&&(a.body.enabled=!0),b.exists=!0)},updateTiles:function(){var a=this;this.tiles.forEach(function(b){var c=a.getTileAt("shades",b.tileBasedPosition);a.setRenderableTiles(b,c);c.exists&&a.updateShadeAlpha(c);d.bodys&&a.game.debug.body(b)})},updateUICoinText:function(){this.coinCountText.text=
" "+this.player.pickups+" / "+this.coins.children.length},updateUIEnemyText:function(){this.enemyCountText.text=" "+this.player.killedEnemies+" / "+this.numberOfEnemies},testLevelComplete:function(){this.player.tileBasedPosition[0]===this.end.tileBasedPosition[0]&&this.player.tileBasedPosition[1]===this.end.tileBasedPosition[1]&&(this.numberOfEnemies===this.player.killedEnemies&&this.coins.children.length===this.player.pickups?this.nextLevel():this.notify(this.end.position.x+d.tilesSize/2,this.end.position.y-
d.tilesSize/2,"Level not clear yet..."))},nextLevel:function(){d.level++;d.mapWidth+=this.sizeIncrementsWidth;d.mapHeight+=this.sizeIncrementsHeight;d.playerHealth=5<=this.player.health?this.player.health:this.player.health+1;d.setGameData();this.game.state.start("Game.Play")},notify:function(a,b,c){this.notificationText.revive();this.notificationText.x=a;this.notificationText.y=b;this.notificationText.setText(c);this.notificationTextTweenIn.start()},shutdown:function(){this.game.sound.stopAll()}};
var n=new Phaser.Game(d.config);n.state.add("Game.Boot",d.Boot);n.state.add("Game.Preload",d.Preload);n.state.add("Game.Menu",d.Menu);n.state.add("Game.Credits",d.Credits);n.state.add("Game.HowTo",d.HowTo);n.state.add("Game.Play",d.Play);n.state.start("Game.Boot")})();